/*
	jis2sjis.c

	--- public domain, no warranty.
*/

#include "common.h"

LOCAL	const UH	zen2han_table[][96] = {
	/* 0x2120-0x217f */
	{0x0000, 0x2000, 0xa400, 0xa100, 0x2c00, 0x2e00, 0xa500, 0x3a00,
	 0x3b00, 0x3f00, 0x2100, 0xde00, 0xdf00, 0x2700, 0x6000, 0x0000,
	 0x5e00, 0x7e00, 0x5f00, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0xb000, 0x2d00, 0x2d00, 0x2f00,
	 0x5c00, 0x0000, 0x0000, 0x7c00, 0x0000, 0x0000, 0x6000, 0x2700,
	 0x2200, 0x2200, 0x2800, 0x2900, 0x0000, 0x0000, 0x5b00, 0x5d00,
	 0x7b00, 0x7d00, 0x3c00, 0x3e00, 0x0000, 0x0000, 0xa200, 0xa300,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x2b00, 0x2d00, 0x0000, 0x0000,
	 0x0000, 0x3d00, 0x0000, 0x3c00, 0x3e00, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x2700, 0x2200, 0x0000, 0x5c00,
	 0x2400, 0x0000, 0x0000, 0x2500, 0x2300, 0x2600, 0x2a00, 0x4000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},

	/* 0x2220-0x227f */
	{0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x2300, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},

	/* 0x2320-0x237f */
	{0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x3000, 0x3100, 0x3200, 0x3300, 0x3400, 0x3500, 0x3600, 0x3700,
	 0x3800, 0x3900, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x4100, 0x4200, 0x4300, 0x4400, 0x4500, 0x4600, 0x4700,
	 0x4800, 0x4900, 0x4a00, 0x4b00, 0x4c00, 0x4d00, 0x4e00, 0x4f00,
	 0x5000, 0x5100, 0x5200, 0x5300, 0x5400, 0x5500, 0x5600, 0x5700,
	 0x5800, 0x5900, 0x5a00, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x6100, 0x6200, 0x6300, 0x6400, 0x6500, 0x6600, 0x6700,
	 0x6800, 0x6900, 0x6a00, 0x6b00, 0x6c00, 0x6d00, 0x6e00, 0x6f00,
	 0x7000, 0x7100, 0x7200, 0x7300, 0x7400, 0x7500, 0x7600, 0x7700,
	 0x7800, 0x7900, 0x7a00, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},

	/* 0x2420-0x247f */
	{0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},

	/* 0x2520-0x257f */
	{0x0000, 0xa700, 0xb100, 0xa800, 0xb200, 0xa900, 0xb300, 0xaa00,
	 0xb400, 0xab00, 0xb500, 0xb600, 0xb6de, 0xb700, 0xb7de, 0xb800,
	 0xb8de, 0xb900, 0xb9de, 0xba00, 0xbade, 0xbb00, 0xbbde, 0xbc00,
	 0xbcde, 0xbd00, 0xbdde, 0xbe00, 0xbede, 0xbf00, 0xbfde, 0xc000,
	 0xc0de, 0xc100, 0xc1de, 0xaf00, 0xc200, 0xc2de, 0xc300, 0xc3de,
	 0xc400, 0xc4de, 0xc500, 0xc600, 0xc700, 0xc800, 0xc900, 0xca00,
	 0xcade, 0xcadf, 0xcb00, 0xcbde, 0xcbdf, 0xcc00, 0xccde, 0xccdf,
	 0xcd00, 0xcdde, 0xcddf, 0xce00, 0xcede, 0xcedf, 0xcf00, 0xd000,
	 0xd100, 0xd200, 0xd300, 0xac00, 0xd400, 0xad00, 0xd500, 0xae00,
	 0xd600, 0xd700, 0xd800, 0xd900, 0xda00, 0xdb00, 0x0000, 0xdc00,
	 0x0000, 0x0000, 0xa600, 0xdd00, 0xb3de, 0x0000, 0x0000, 0x0000,
	 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000},
};

EXPORT	W	zen2han(UH jis, UB *buf)
{
	W	h, l, len;
	UH	c;

	len = 0;

	h = (jis >> 8) & 0xff;
	l = (jis >> 0) & 0xff;

	/* not in range */
	if (h < 0x21 || h > 0x25) goto fin0;
	if (l < 0x20 || l > 0x7f) goto fin0;

	h -= 0x21;
	l -= 0x20;
	c = zen2han_table[h][l];

	/* not in table */
	if (!c) goto fin0;

	buf[0] = (c >> 8) & 0xff;
	buf[1] = (c >> 0) & 0xff;

	len = buf[1] ? 2 : 1;
fin0:
	return len;
}

EXPORT	UH	_mbcjistojms(UH jis)
{
	UH	low, high;

	high = (jis >> 8) & 0xff;
	low  =  jis       & 0xff;

	/* 2nd byte */
	low += (high & 1) ? 0x1f : 0x7d;
	if (low > 0x7e) low++;

	/* 1st byte */
	high  = (high + 1) / 2;
	high += (high < 0x30) ? 0x70 : 0xb0;

	return (high << 8) | low;
}
